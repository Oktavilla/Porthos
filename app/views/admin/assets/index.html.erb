<% @page_title = "Bilder, filmer, ljud och dokument" %>
<% @page_class = 'layout3' %>
  <%= render :partial => 'admin/assets/sub_nav' %>
  <div id="workspace">
    <% if @current_tags.any? -%>
    <div class="header">
      <h1>Filer märkta med: <%= @current_tags.join(', ') %></h1>  
      <% if @related_tags && @related_tags.any? -%>
      <div class="related_tags">
        <% @related_tags.each do |tag| %>
        <span class="tag"><%= link_to tag.name, admin_assets_path(:tags => @current_tags + [tag.name]), :class => "tag" %></span>
        <% end %>
      </div>
      <% end -%>
    </div>
    <% else -%>
    <div class="header">
      <h1>Bilder, filmer, ljud och dokument</h1>
    </div>
    <div class="tools">
      <div class="add">
        <a href="<%= new_admin_asset_path %>" class="new">Ladda upp filer</a>
      </div>
      <% form_tag admin_assets_path, :method => :get do |f| %>
      <div class="sort">
        <label for="filters_order_by">Sortering</label>
        <% @filters.without(:order_by).each do |filter, value| -%>
          <%= hidden_field_tag "filters[#{filter}]", value %>
        <% end -%>
          <%= select_tag 'filters[order_by]', options_for_select({ 'Datum' => 'created_at desc', 'A-Z' => 'title asc', 'Storlek' => 'size' }, @filters[:order_by]) %>
          <input type="submit" value="Välj" id="filters_order_by_submit" style="display:none">
      </div>
      <% end %>
    </div>
    <% end -%>
    <div id="content">
      <% if @content -%>
      <p>
        <span style="background:#ffb">Välj vilken bild/film du vill använda eller ladda upp en ny.</span>
        <%= link_to "Avbryt", previous_view_path %> 
      </p>
      <% end -%>
      <% if @assets.any? -%>
      <ul class="items thumbnails">
        <% @assets.each do |asset| -%>
        <li>
          <a href="<%= edit_admin_asset_path(asset) %>">
          <% if asset.image? %>
            <%= image_tag display_image_path(:size => 'c100x100', :id => asset, :format => asset.extname), :id => "asset_#{asset.id}", :width => 100, :height => 100 %>
          <% elsif asset.respond_to?(:thumbnail) and not asset.thumbnail.blank? %>
            <%= image_tag display_image_path(:size => 'c100x100', :id => asset.thumbnail, :format => asset.thumbnail.extname), :id => "asset_#{asset.id}", :width => 100, :height => 100 %>
          <% else %>
            <img src="/graphics/porthos/icons/filetypes/<%= asset.extname %>.png" alt="" width="100" height="100">
          <% end %>
          </a>
          <div class="title"><%= link_to asset.title, edit_admin_asset_path(asset) %></div>
          <div class="description<%= ' blank' if asset.description.blank? %>">
            <%= asset.description.blank? ? "<a href=\"#{edit_admin_asset_path(asset)}\">Ingen beskrivning. Skriv en ...</a>" : truncate(asset.description, :length => 200) %>
          </div>
          <% unless asset.tag_names.blank? %>
          <div class="tags"><%= asset.tags.collect { |tag| @current_tags.include?(tag.name) ? tag.name : link_to(tag.name, admin_assets_path(:tags => [tag.name])) }.join(', ') -%></div>
          <% end %>
          <div class="meta">
            <span>Uppladdad</span> den <%= asset.created_at.strftime("%d %b %Y") %>
            <% unless asset.created_by.nil? -%>
            <span>av</span> <%= asset.created_by.name %>
            <% end -%>
          </div>
          <div class="edit">
            <%= link_to "Ändra", edit_admin_asset_path(asset) %>
            <%= link_to "Ta bort", admin_asset_path(asset), :class => 'delete', :confirm => "Är du säker att du vill ta bort filen? Den kommer försvinna från alla sidor. Du kan INTE ångra dig.", :method => :delete %>
          </div>
          <% if @content -%>
          <div class="add">
            <% if asset.image? %>
            <%= link_to "Välj", new_admin_content_path({:content => @content, :resource => { :image_asset_id => asset.id }}.merge(@context_params)), :class => 'new' %>
            <% elsif asset.movie? %>
            <%= link_to "Välj", new_admin_content_path({:content => @content, :resource => { :movie_asset_id => asset.id }}.merge(@context_params)), :class => 'new' %>
            <% end %>
          </div>
          <% end %>
        </li>
        <% end %>
      </ul>
      <%= will_paginate @assets, :prev_label => "« Föregående", :next_label => "Nästa »" unless @current_tags.any? %>
      <% end -%>
    </div>
  </div>
<%= javascript_include_tag 'named_routes' %>
<%= javascript_include_tag 'porthos/prototype', 'porthos/effects', 'porthos/controls', 'porthos/dragdrop', 'porthos/lowpro', 'porthos/lib', 'porthos/application', 'porthos/safari_search', :cache => 'admin' %>
<%= javascript_include_tag 'porthos/swfupload/swfupload', 'porthos/swfupload/swfupload.queue.js', 'porthos/assets', 'porthos/swfobject', 'porthos/mediaplayer', :cache => 'assets_uploader' %>