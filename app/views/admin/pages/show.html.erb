<% @page_class = "A content" -%>
<div id="workspace">
  <div class="header">
    <h1><%= @page.title %></h1>
    <%= link_to "Redigera", edit_admin_page_path(:id => @page, :return_to => request.request_uri), :class => 'edit_settings' %>
    <% unless @page.is_a? PageCollection %>
      <%= link_to 'Förhandsgranska', preview_page_path(@page.id), :class => 'public_link' %>
    <% else %>
      <%= link_to "Lägg till / redigera sidor", admin_page_collection_path(@page) %>
    <% end %>
  </div>
  <span class="controls">
    <% if @page.comments.any? %>
      <%= link_to 'Kommentarer', comments_admin_page_path(:id => @page), :class => 'comments' %>
    <% end %>
  </span>
  <div id="content">
    <div id="ca">
      <% if not @page.active? -%>
      <p class="notice">
        Denna sida är inte aktiverad och kommer inte att synas på siten. <%= link_to "Aktivera sidan »", toggle_admin_page_path(@page), :method => :put %>
      </p>
      <% elsif @page.unpublished_changes? -%>
      <p class="notice"><%= link_to "Publicera ändringarna", publish_admin_page_path(@page), :method => :put %></p>
      <% end -%>
      <div id="page_<%= @page.id %>" class="page_layout <%= @page.layout_class %>">
      <% (1..@page.column_count).each do |column| -%>
        <div id="column_<%= column %>" class="column">
          <div class="inner">
            <span class="sort_contents controls">
              <a class="add" href="#">Lägg till innehåll</a>
            <% if @page.contents.any? -%>
              <%= link_to("Sortera innehåll", sort_admin_contents_path, :class => 'sort fr') %>
              <%= display_indicator :id => 'page_contents_indicator' %>
            <% end -%>
            </span>
            <div class="sub_controls" style="display:none;">
              <ul>
                <li>
                  <a class="text Textfield new_content" href="<%= new_admin_content_path(:content => { :context_id => @page.id, :context_type => 'Page', :context_id => @page.id, :context_type => 'Page', :resource_type => 'Textfield', :column_position => column }) %>">Text</a>
                </li>
                <li>
                  <a class="form RegistrationForm new_content" href="<%= new_admin_content_path(:content => { :context_id => @page.id, :context_type => 'Page', :resource_type => 'RegistrationForm', :column_position => column }) %>">Formulär</a>
                </li>
                <li class="cl">
                  <a class="image ContentImage" href="<%= admin_assets_path(:type => 'ImageAsset', :content => { :context_id => @page.id, :context_type => 'Page', :resource_type => 'ContentImage', :column_position => column }) %>">Bild</a>
                </li>
                <li>
                  <a class="shared_content new_content" href="<%= new_admin_content_path(:content => { :context_id => @page.id, :context_type => 'Page', :resource_type => 'Textfield', :column_position => column }, :resource => { :shared => 1 }) %>">Delat innehåll</a>
                </li>
                <li class="cl">
                  <a class="image ContentImage" href="<%= new_admin_content_path(:collection => 1, :content => { :context_id => @page.id, :context_type => 'Page', :resource_type => 'ContentImage', :column_position => column }) %>">Bildsamling</a>
                </li>
                <li>
                  <a class="movie ContentMovie" href="<%= new_admin_content_path(:content => { :context_id => @page.id, :context_type => 'Page', :resource_type => 'ContentMovie', :column_position => column }) %>">Film</a>
                </li>
                <li class="cl">
                  <a class="teasers Teaser new_content" href="<%= new_admin_content_path(:collection => 1, :content => { :context_id => @page.id, :context_type => 'Page', :resource_type => 'Teaser', :column_position => column }) %>">Puffar</a>
                </li>
                <li>
                  <a class="module ContentModule new_content" href="<%= new_admin_content_path(:content => { :context_id => @page.id, :context_type => 'Page', :resource_type => 'ContentModule', :column_position => column }) %>">Modul</a>
                </li>
              </ul>
            </div>
            <ul class="contents sortable" id="contents_in_column_<%= column %>">
            <% @page.contents.find_all { |content| content.column_position == column }.each do |content| -%>
              <li class="<%= "#{content.resource_type} content " unless content.collection? %><%= ' collection' if content.collection? %> sortable <%= content.resource_type.underscore %>_wrapper<%= " shared" if content.shared? %><%= content.active? ? ' active' : ' inactive' %>" id="content_<%= content.id %>">
              <span class="draghandle"></span>
              <span class="inactive_proxy"></span>
              <% if content.restricted? -%>
              <div class="restriction-info">
                <ul>
                <% content.restrictions.each do |restriction| -%>
                  <li><%= t(restriction.mapping_key, :scope => [:app, :restrictions]) %></li>
                <% end -%>
                </ul>
              </div>
              <% end -%>
              <% unless content.collection? -%>
                <span class="type"></span>
                <span class="controls">
                  <% if content.module? and content.resource.has_settings? %>
                    <%= link_to("Inställningar", settings_admin_content_path(content), :class => (!content.collection? ? 'settings' : 'settings')) %>
                  <% end %>
                  <%= link_to("Ändra", edit_admin_content_path(content), :class => (!content.collection? ? 'edit' : 'edit')) if not content.module? %>
                  <%= link_to content.active? ? 'Dölj' : 'Visa', toggle_admin_content_path(content), :method => :put, :class => 'visibility' %>
                  <%= link_to "Ta bort", admin_content_path(content), :method => :delete, :confirm => "Är du säker? Detta går inte att ångra.", :class => 'delete' %>
                </span>
                <%= render :partial => content.resource_template, :locals => { :resource => content.resource, :content => content } %>
              <% else %>
                <%= render :partial => content.collection_template, :locals => { :content => content } %>
              <% end %>
              </li>
            <% end -%>
            </ul>
          </div>
        </div>
      <% end %>
      </div>
    </div>
  </div>
</div>
<%= javascript_include_tag 'named_routes' %>
<%= javascript_include_tag 'porthos/prototype', 'porthos/effects', 'porthos/controls', 'porthos/dragdrop', 'porthos/lowpro', 'porthos/lib', 'porthos/application', 'porthos/safari_search', :cache => 'admin' %>
<%= javascript_include_tag 'porthos/jquery' %>
<%= javascript_include_tag 'porthos/wymeditor/lang/sv' %>
<%= javascript_include_tag 'porthos/wymeditor/jquery.wymeditor' %>
<%= javascript_include_tag 'porthos/wymeditor/plugins/hovertools/jquery.wymeditor.hovertools' %>
<%= javascript_include_tag 'porthos/wymeditor/plugins/tidy/jquery.wymeditor.tidy' %>
<%= javascript_include_tag 'porthos/editor' %>
<%= javascript_include_tag 'porthos/action_dialog', 'porthos/assets', 'porthos/asset_usages', 'porthos/pages', :cache => 'pages' %>
<%= javascript_include_extensions %>