<% @page_title = 'Sidor' -%>
<% @page_class = 'layout3' -%>
<div id="sub_nav">
  <% form_for :asset, :url => search_admin_assets_path(:type => params[:type]), :html => { :method => :get } do |f| %>
  <div class="search fullwidthinput">
    <%= text_field_tag :query, (@query || 'Sök'), :class => "search_query", :id=> "search_query" %>
    <%= submit_tag "Sök", :style => "display:none" %>
  </div>
  <% end %>
  <ul class="filter">
    <li class="current"><a href="#">Alla</a></li>
    <li><a href="#">Nyheter</a></li>
    <li><a href="#">Pressmeddelanden</a></li>
  </ul>
  <div class="label">Sortering</div>
  <ul class="filter">
    <li class="current"><a href="#">Datum</a></li>
    <li><a href="#">A-Z</a></li>
  </ul>
  <div class="label">Senast ändrad av</div>
  <ul class="filter">
    <li class="current"><a href="#">Alla</a></li>
    <li><a href="#">Alexis Fellenius</a></li>
    <li><a href="#">Arvid Andersson</a></li>
    <li><a href="#">Joel Junström</a></li>
  </ul>
<% if @current_tags.any? -%>
  <div class="label">Valda nyckelord</div>
  <ul class="tags current">
  <% @current_tags.each do |current_tag| %>
    <li>
      <span class="tag"><%= current_tag %></span> <%= link_to "Ta bort", admin_pages_path(:tags => @current_tags - [current_tag]) %>
    </li>
  <% end -%>
  </ul>
  <% if @related_tags.any? -%>
  <div class="label">Relaterade nyckelord</div>
  <ul class="tags">
  <% @related_tags.each do |tag| -%>
    <li><%= link_to tag.name, admin_pages_path(:tags => @current_tags + [tag.name]), :class => "tag" %></li>
  <% end -%>
  </ul>
  <% end -%>
<% end -%>
<% if @tags.any? -%>
  <div class="label">Nyckelord</div>
  <ul class="tags">
  <% @tags.sort_by { |tag| tag.name }.each do |tag| -%>
    <li><span class="letter">A</span>
      <ul>
        <% @tags.sort_by { |tag| tag.name }.each do |tag| -%>
        <li><%= link_to "#{tag.name.downcase}", admin_pages_path(:tags => [tag.name]), :class => "tag" -%></li>
        <% end %>
      </ul>
    </li>
  <% end -%>
  </ul>
<% end -%>
</div>
<div id="workspace">
  <div class="header">
    <h1>Dina sidor</h1>
  </div>
  <div class="tools">
    <%= link_to "Skapa en ny sida", new_admin_page_path, :class => 'create' %>
    <%= link_to "Skapa en ny sidsamling", new_admin_page_collection_path, :class => 'create' if current_user.can_create?(PageCollection) %>
  </div>
  <div id="content">
  <% if current_user.created_pages.any? %>
    <h2>Sidor du har skapat</h2>
    <ul class="items">
    <% current_user.created_pages.each do |page| %>
      <li>
      <%= render :partial => 'page', :locals => {:page => page} %>
      </li>
    <% end %>
    </ul>
  <% end %>
  <% if current_user.updated_pages.any? %>
    <h2>Senaste sidor du har jobbat med</h2>
    <%= render :partial => 'list_of_pages', :locals => {:pages => current_user.updated_pages} %>
  <% end %>
  <% unless @current_tags.any? %>
    <% if latest_updated_pages = Page.updated_latest.find(:all, :limit => 10) %>
      <h2>Senaste uppdaterade sidor</h2>
      <%= render :partial => 'list_of_pages', :locals => {:pages => latest_updated_pages} %>
    <% end %>
  <% else %>
    <h2>Sidor som matchar din nyckelordssökning</h2>
    <% if not @tagged_pages.any? %>
      <p>Inga sidor hittades</p>
    <% else %>
      <%= render :partial => 'list_of_pages', :locals => {:pages => @tagged_pages, :current_tags => @current_tags} %>
    <% end %>
  <% end %>
  </div>
</div>