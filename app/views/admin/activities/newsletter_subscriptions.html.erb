<% @page_class = 'AxB' -%>
<div id="content_header">
  <%= link_to "« Tillbaka till översikt", admin_activities_path, :class => 'back' %>
  <h1>E-postadresser</h1>
</div>
<div id="container">
  <div id="content">
    <div id="ca">
      <div class="inner">
        <%= render :partial => 'activities_nav', :locals => {:type => @type} %>
      </div>
    </div>
    <div id="cb">
      <div class="inner">
        <% activity_table(@first_period, @second_period) do %>
          <tbody>
            <tr class="totals">
              <th scope="colgroup">E-postadresser</th>
              <% num_first_period, num_second_period = Registration.with_period(@first_period).with_opt_in.count, Registration.with_period(@second_period).with_opt_in.count -%>
              <% diff = num_first_period - num_second_period -%>
              <td><%= num_second_period %> st</td>
              <td><%= num_first_period %> st</td>
              <td><%= '+' if diff > 0 %><%= diff %> st</td>
            </tr>
            <tr>
              <th scope="row">Via anmälan</th>
              <% num_direct_first_period, num_direct_second_period = NewsletterSubscription.with_period(@first_period).count, NewsletterSubscription.with_period(@second_period).count -%>
              <% diff = num_direct_first_period - num_direct_second_period %>
              <td><%= num_direct_second_period %> st</td>
              <td><%= num_direct_first_period %> st</td>
              <td><%= '+' if diff > 0 %><%= diff %> st</td>
            </tr>
            <tr>
              <th scope="row">Via opt-in</th>
              <% diff = (num_first_period - num_direct_first_period) - (num_second_period - num_direct_second_period) %>
              <td><%= num_second_period - num_direct_second_period %> st</td>
              <td><%= num_first_period - num_direct_first_period %> st</td>
              <td><%= '+' if diff > 0 %><%= diff %> st</td>
            </tr>
          </tbody>
        <% end %>
      </div>
    </div>
  </div>
</div>

<%= javascript_include_merged :admin %>